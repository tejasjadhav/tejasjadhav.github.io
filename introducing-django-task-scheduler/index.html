<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style id="typography.js">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:112.5%/1.2 'Libre Baskerville',serif;box-sizing:border-box;overflow-y:scroll;}*{box-sizing:inherit;}*:before{box-sizing:inherit;}*:after{box-sizing:inherit;}body{color:hsla(0,0%,0%,0.8);font-family:'Libre Baskerville',serif;font-weight:400;word-wrap:break-word;font-kerning:normal;-moz-font-feature-settings:"kern", "liga", "clig", "calt";-ms-font-feature-settings:"kern", "liga", "clig", "calt";-webkit-font-feature-settings:"kern", "liga", "clig", "calt";font-feature-settings:"kern", "liga", "clig", "calt";}img{max-width:100%;margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:0.8rem;}h1{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:0.8rem;color:hsla(0,0%,0%,1);font-family:'Raleway',sans-serif;font-weight:800;text-rendering:optimizeLegibility;font-size:2rem;line-height:1.1;}h2{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:0.8rem;color:hsla(0,0%,0%,1);font-family:'Raleway',sans-serif;font-weight:800;text-rendering:optimizeLegibility;font-size:1.51572rem;line-height:1.1;}h3{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:0.8rem;color:hsla(0,0%,0%,1);font-family:'Raleway',sans-serif;font-weight:800;text-rendering:optimizeLegibility;font-size:1.31951rem;line-height:1.1;}h4{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:0.8rem;color:hsla(0,0%,0%,1);font-family:'Raleway',sans-serif;font-weight:800;text-rendering:optimizeLegibility;font-size:1rem;line-height:1.1;}h5{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:0.8rem;color:hsla(0,0%,0%,1);font-family:'Raleway',sans-serif;font-weight:800;text-rendering:optimizeLegibility;font-size:0.87055rem;line-height:1.1;}h6{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:0.8rem;color:hsla(0,0%,0%,1);font-family:'Raleway',sans-serif;font-weight:800;text-rendering:optimizeLegibility;font-size:0.81225rem;line-height:1.1;}hgroup{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:0.8rem;}ul{margin-left:1.2rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:0.8rem;list-style-position:outside;list-style-image:none;}ol{margin-left:1.2rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:0.8rem;list-style-position:outside;list-style-image:none;}dl{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:0.8rem;}dd{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:0.8rem;}p{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:0.8rem;}figure{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:0.8rem;}pre{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:0.8rem;font-size:0.85rem;line-height:1.2rem;}table{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:0.8rem;font-size:18;line-height:1.8rem;border-collapse:collapse;width:100%;}fieldset{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:0.8rem;}blockquote{margin-left:0.8rem;margin-right:0.8rem;margin-top:0.8rem;padding-bottom:0;padding-left:0.8rem;padding-right:0;padding-top:0;margin-bottom:0.8rem;color:hsla(0,0%,0%,0.7340000000000001);border-left:4px solid #999;}form{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:0.8rem;}noscript{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:0.8rem;}iframe{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:0.8rem;}hr{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:calc(0.8rem - 1px);background:hsla(0,0%,0%,0.2);border:none;height:1px;}address{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:0.8rem;}b{font-weight:700;}strong{font-weight:700;}dt{font-weight:700;}th{font-weight:700;}li{margin-bottom:calc(0.8rem / 2);}ol li{padding-left:0;}ul li{padding-left:0;}li > ol{margin-left:1.2rem;margin-bottom:calc(0.8rem / 2);margin-top:calc(0.8rem / 2);}li > ul{margin-left:1.2rem;margin-bottom:calc(0.8rem / 2);margin-top:calc(0.8rem / 2);}blockquote *:last-child{margin-bottom:0;}li *:last-child{margin-bottom:0;}p *:last-child{margin-bottom:0;}li > p{margin-bottom:calc(0.8rem / 2);}code{font-size:0.85rem;line-height:1.2rem;}kbd{font-size:0.85rem;line-height:1.2rem;}samp{font-size:0.85rem;line-height:1.2rem;}abbr{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}acronym{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}abbr[title]{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;text-decoration:none;}thead{text-align:left;}td,th{text-align:left;border-bottom:1px solid hsla(0,0%,0%,0.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding-left:0.8rem;padding-right:0.8rem;padding-top:0.6rem;padding-bottom:calc(0.6rem - 1px);}th:first-child,td:first-child{padding-left:0;}th:last-child,td:last-child{padding-right:0;}@media only screen and (max-width:480px){html{font-size:80%;line-height:19.2px;}}a{font-weight:bold;color:#00f;text-decoration:none;}a:hover{text-decoration:underline;}</style><style data-href="/styles.0da9468f2557c73b37a8.css">code[class*=language-],pre[class*=language-]{color:#000;background:none;text-shadow:0 1px #fff;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{text-shadow:none;background:#b3d4fc}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#f5f2f0}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#999}.token.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{color:#9a6e3a;background:hsla(0,0%,100%,.5)}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.class-name,.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}pre[class*=language-].line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}pre[class*=language-].line-numbers>code{position:relative;white-space:inherit}.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:0;font-size:100%;left:-3.8em;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-ms-user-select:none;user-select:none}.line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}.command-line-prompt{border-right:1px solid #999;display:block;float:left;font-size:100%;letter-spacing:-1px;margin-right:1em;pointer-events:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.command-line-prompt>span:before{color:#999;content:" ";display:block;padding-right:.8em}.command-line-prompt>span[data-user]:before{content:"[" attr(data-user) "@" attr(data-host) "] $"}.command-line-prompt>span[data-user=root]:before{content:"[" attr(data-user) "@" attr(data-host) "] #"}.command-line-prompt>span[data-prompt]:before{content:attr(data-prompt)}.gatsby-highlight-code-line{background-color:#feb;display:block;margin-right:-1em;margin-left:-1em;padding-right:1em;padding-left:.75em;border-left:.25em solid #f99}.gatsby-highlight{background-color:#fdf6e3;margin:.5em 0;padding:1em;overflow:auto;border:2px solid #dfa700}.gatsby-highlight pre[class*=language-]{background-color:transparent;margin:0;padding:0;overflow:initial;float:left;min-width:100%}.gatsby-highlight pre[class*=language-].line-numbers{padding-left:2.8em}.gatsby-code-title{margin-bottom:-.6rem;padding:.25em 1em;font-size:.9em;font-weight:700;font-family:Consolas,Roboto Mono,Liberation Mono,Menlo,Courier,monospace;background-color:#dfa700;z-index:0}code,code[class*=language-],pre,pre[class*=language-],table.monospace{font-family:Consolas,Roboto Mono,Liberation Mono,Menlo,Courier,monospace;line-height:1.1;font-size:.95em}@media (prefers-color-scheme:dark){:not(pre)>code[class*=language-]{color:#fff;background-color:#333;text-shadow:none}.line-numbers-rows,pre>code[class*=language-]{color:#fff;text-shadow:none}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{background-color:transparent}.gatsby-highlight,.gatsby-highlight-code-line{background-color:#000}.gatsby-highlight{border-color:#1e8eba}.gatsby-code-title{background-color:#1e8eba;color:#fff}}@media (prefers-color-scheme:dark){body,html{background-color:#000}blockquote,body,h1,h2,h3,h4,h5,h6,html{color:#fff}a{color:#fb7979}hr{background-color:#fff}}</style><meta name="generator" content="Gatsby 2.20.25"/><link rel="preconnect dns-prefetch" href="https://www.google-analytics.com"/><link rel="alternate" type="application/rss+xml" href="/rss.xml"/><link rel="icon" href="/icons/icon-48x48.png?v=c7e4d8cf5ea7282a6913c3666c22c4c6"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="theme-color" content="#663399"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=c7e4d8cf5ea7282a6913c3666c22c4c6"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=c7e4d8cf5ea7282a6913c3666c22c4c6"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=c7e4d8cf5ea7282a6913c3666c22c4c6"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=c7e4d8cf5ea7282a6913c3666c22c4c6"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=c7e4d8cf5ea7282a6913c3666c22c4c6"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=c7e4d8cf5ea7282a6913c3666c22c4c6"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=c7e4d8cf5ea7282a6913c3666c22c4c6"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=c7e4d8cf5ea7282a6913c3666c22c4c6"/><title data-react-helmet="true">Introducing: Scheduler • Tejas Jadhav</title><meta data-react-helmet="true" name="description" content="Scheduler is a small task scheduling utility built for Django using Celery. A lot of interesting projects start by solving a simple but essential problems of…"/><meta data-react-helmet="true" property="og:title" content="Introducing: Scheduler"/><meta data-react-helmet="true" property="og:description" content="Scheduler is a small task scheduling utility built for Django using Celery. A lot of interesting projects start by solving a simple but essential problems of…"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="_tejasjadhav"/><meta data-react-helmet="true" name="twitter:title" content="Introducing: Scheduler"/><meta data-react-helmet="true" name="twitter:description" content="Scheduler is a small task scheduling utility built for Django using Celery. A lot of interesting projects start by solving a simple but essential problems of…"/><link href="//fonts.googleapis.com/css?family=Raleway:800|Libre+Baskerville:400,400i,700" rel="stylesheet" type="text/css"/><link as="script" rel="preload" href="/webpack-runtime-90fe9894775700252564.js"/><link as="script" rel="preload" href="/framework-c88d07efb40e009babfb.js"/><link as="script" rel="preload" href="/styles-1c3c06048fccead674b8.js"/><link as="script" rel="preload" href="/app-fc4d0f0a2c7f65435551.js"/><link as="script" rel="preload" href="/d5d7a013bc6c1e2b6d7db819052c16d7efea5559-baf100a1121eb9646ed4.js"/><link as="script" rel="preload" href="/component---src-templates-blog-post-js-0de9500dca1e6e690244.js"/><link as="fetch" rel="preload" href="/page-data/introducing-django-task-scheduler/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div style="margin-left:auto;margin-right:auto;max-width:57.6rem;padding:1.8rem 0.9rem"><header><h3 style="margin-top:0"><a style="box-shadow:none;color:inherit" href="/">Tejas Jadhav</a></h3></header><main><article><header><h1 style="margin-top:1.2rem;margin-bottom:0">Introducing: Scheduler</h1><p style="font-size:0.87055rem;line-height:1.2rem;display:block;margin-bottom:1.2rem">November 25, 2018</p></header><p>Scheduler is a small task scheduling utility built for Django using Celery.</p><p>A lot of interesting projects start by solving a simple but essential problems of some other major problem. So was the case with <a href="https://github.com/tejasjadhav/django-scheduler">Scheduler</a>. At <a href="https://mpaani.com">m.Paani</a>, I had similar such problem.</p><h1>Problem statement</h1><p>I had to execute a task at specific intervals. At first, I tried the one and only, fan-favorite, <em>cronjob</em>. Luckily, Celery has something which does the exact same thing - <code class="language-text">@periodic_task</code>. Just enter your cron rule and your job is done. Voila! Problem solved. Celebrations were too early and I just discovered a few scenarios which could not be done with cron jobs alone.</p><p>To understand this, let’s see how a complicated rule of our old, faithful cron looks like.</p><div class="gatsby-highlight" data-language="cron"><pre class="language-cron"><code class="language-cron">5-30/3 */2 * 1,5,9 2</code></pre></div><p>The above rule translates to,</p><blockquote><p>At every 3rd minute from 5 through 30 past every 2nd hour on Tuesday in January, May, and September. <small><a href="https://crontab.guru/">crontab.guru</a>. You can check the interpretation of the above rule <a href="https://crontab.guru/#5-30/3_*/2_*_1,5,9_2_">here</a>.</small></p></blockquote><p>This seems all nice and fair. However, I had some bizaare use cases.</p><ol><li>Task should execute every 2nd Friday</li><li>Task should execute on second last day on every month</li><li>Task should execute on every even day</li></ol><p>Cron rule for first is still manageable in some cases. For second, it is impossible. And for 3rd, it fails after every month with odd number of days (though the non-standard way of doing it is <code class="language-text">0 0 2/2 * *</code>). After head banging for a day and countless Google searches, I just glanced at my <a href="https://play.google.com/store/apps/details?id=com.google.android.calendar&amp;hl=en">calendar app</a> and saw some recurring events, like weekly sprints, month-end discussions, etc. When I tried to create one with a repetition pattern, I saw half a dozen of configurations. Initially, it seemed like some Google kinda stuff (of course, you can only expect such sophistications from a Google-like company). But, then I saw similar settings on <a href="https://wiki.gnome.org/Apps/Evolution">Evolution</a>. To my utter surprise, I could edit the reccurence rules set for the event on Google Calendar, and then on the app, those changes got sync’d up. This commonality means that there’s some practice or convention followed by both. After digging about it for some time, I hit the jackpot. It’s called <em>Recurrence Rules</em> which is an actual <a href="https://tools.ietf.org/html/rfc2445">standard set by the IEFT</a> (the gods behind everything related to internet including HTTP, LDAP, sockets, etc. You can check the list of standards they have in place <a href="https://www.rfc-editor.org/rfc-index.html">here</a>.)</p><h1>Recurrence rules <em>(RRULE)</em></h1><p>They are similar to cron jobs. Like cron, they solve the problem of defining rules for programming date and time patterns. Unlike cron, RRULE is a complete <a href="https://blog.tejasjadhav.xyz/2016/06/06/domain-specific-languages-using-python-part-1/">DSL</a> with limited grammar. You can stack multiple RRULEs to create an inclusion-exclusion pattern. Look at this example below,</p><div class="gatsby-highlight" data-language="rrule"><pre class="language-rrule"><code class="language-rrule">RRULE:FREQ=DAILY;COUNT=5</code></pre></div><p>The above rule executes every day for the next 5 days. Not amused, take another example,</p><div class="gatsby-highlight" data-language="rrule"><pre class="language-rrule"><code class="language-rrule">RRULE:FREQ=MONTHLY;COUNT=3;BYDAY=-2MO</code></pre></div><p>This rule executes every second last day of the month for the next 3 months. Sounds familiar? Yes, this solves my second use case too.</p><div class="gatsby-highlight" data-language="rrule"><pre class="language-rrule"><code class="language-rrule">RRULE:FREQ=DAILY;INTERVAL=2;BYSETPOS=2</code></pre></div><h1>Implementation</h1><p>One by one, all my usecases were handled by RRULEs. But building a complete RRULE parser in Python is a prodigious chore. I had written an article about writing DSLs in Python a while back which you may refer to understand how much does it take to build a basic DSL. This was just too much for me to do. I almost settled for cronjobs again when I realised that the <a href="https://pypi.python.org/pypi/python-dateutil"><code class="language-text">python-dateutil</code></a> library has something already built related to RRULEs. Oh yes! They had built an RRULE parser (<a href="https://dateutil.readthedocs.io/en/stable/rrule.html"><code class="language-text">dateutil.rrule</code></a>) which, in fact, also has a Python API giving an even greater control of the individual elements of the RRULE. Such a sweet delight!</p><p>The library has a function <code class="language-text">dateutil.rrule.rrulestr</code> which converts a raw RRULE string into a <code class="language-text">rrule</code> object. The best part about this object is, some parameters of the RRULE can be changed directly by modifying the object properties, like the <code class="language-text">dtstart</code> parameter. Also, the best part is, the <code class="language-text">rrule</code> object is a generator, which means I can iterate over it and it will give me the next timestamp in the sequence. Overall, this utility provided the perfect suite for managing RRULEs.</p><p>Th initial idea for flow was,</p><ol><li>Get the RRULEs from the database defined by the user</li><li>Build the <code class="language-text">rrule</code> object</li><li>Get the next timestamp in the sequence</li><li>Pickle the <code class="language-text">rrule</code> object and store it in the database and execute the function at the specified timestamp using the <code class="language-text">eta</code> argument in Celery’s <code class="language-text">apply_async</code> function.</li><li>When the function gets executed, unpickle the <code class="language-text">rrule</code> object, get the next timestamp and then repeat step 4.</li><li>Repeat until <code class="language-text">rrule</code> no longer returns a timestamp.</li></ol><p>However, there was one major issue. The <code class="language-text">rrule</code> object was <a href="https://docs.python.org/3.7/library/pickle.html#pickle-picklable">unpickable</a>. Further I realised, the <code class="language-text">rrule</code> object was not a generator but an iterator instead. A workaround for this (a hack!) was to get the time when the function last executed and keep fetching the next timestamp from the <code class="language-text">rrule</code> iterator until the next timestamp was greater than the current one. Since I no longer had to pickle the <code class="language-text">rrule</code> object, I just stored the last executed timestamp in the database which, in my opinion, is a much cleaner solution and much more library agnostic.</p><p>Also, I didn’t want to interfere with the usual way Celery works and wanted this flow to be introduced with as little custom code as possible. So, instead of creating a new task decorator, I preferred <a href="http://docs.celeryproject.org/en/latest/userguide/tasks.html#task-inheritance">Celery’s task inheritence</a> and created a base task class called <code class="language-text">RepeatTask</code> which contained the entire logic for fetching the function, fetching the arguments and keyword arguments, executing the function, getting the next timestamp and then scheduling the task for next execution.</p><p>I’ve added the installation and usage details in the <a href="https://github.com/tejasjadhav/django-scheduler/blob/master/README.md">README</a> of the <a href="https://github.com/tejasjadhav/django-scheduler/">repository</a>. Please check it out. The library is still in alpha and yet to be published on PyPI.</p><hr style="margin-bottom:1.2rem"/><div shortname="tejasjadhav" config="[object Object]" id="disqus_thread"></div><footer><div style="display:flex;margin-bottom:3rem"><div class=" gatsby-image-wrapper" style="position:relative;overflow:hidden;display:inline-block;width:50px;height:50px;margin-right:0.6rem;margin-bottom:0;min-width:50px;border-radius:100%"><img aria-hidden="true" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAFRUlEQVQ4y22Se1CNaRjAv9gs1mgMy0hhrCR3XaR0XxopmVSqQ1lOytkSKdWWOimhiy7ndL+RpMtJotJVdCq2ENZtjEXsbrSWsWutP8zsb7/O8s/OfjO/7/2+5/3e3/e8z/MK5vI8HG2smGc4Hx0dHcaNG4e29meM0tLSoKUlIAiCOIrvo7QYrWGUBn19fZycnAgMDOTDhw+MXMJPL4Zx9/BAV1dXs/D/+CT9L1+MH4+xsTGurq6oamr4e0Q4NDSEj0SCnZ0dU6dO1XzoYrkcD1szrBYboP/lJE3MQG8aktUrkXxtTqjnWkwN52ji+np6mJqZocjJ/TfDy91qXJzW4ujoyOQpU/hcezR9BQkMVqdx93giXVmRJEk3os6K4mHFEe4cS+TXszlcUuxn7BhtJk6YwCJLW0ISU3jy9CnCs3cfWBMQip2NtfhHLdysTXl+JpsbRfEMiNwWBQ/KD/FDaQLXCuRcL5RzqySRP1qKCfNap8ly2pTJLLRZjUFhF8KKnrdM8pezyOArBK3R7PNxZrAmg4ZDIfRkR6NWRHH543hNlI1kXH8wmGeqTKTOdhrh7KmTmeX1LTMv/I4ws+01+vldGFrYaiY97c3JkHnhI9Zwi/0KQjbY0SPKqmMD2GxrjKeVMVJHS2rkQTiYLNSsMTIywiClljkdbxDmtgwzu/Mty7z8GS1ObvXy4E5fL+nJRyjNzaG2SMEakwUEebvSWF1BYbaS4yUlXG9vwHSREWNHhFtDmXXpPV81vxCFrcNMqxvENyiYxdN1cLBeBX++oqayks62NnobasjZ5U1eVCAvnz2ivbmZy2o1Qzd6maQzkU3m81kTcwTdtjcYtL1CMOx8x4yO92wNj2LPOkvWWixHGSYlOdSftLAAFLt9uZC8l47UvaQFbyF5j5SjoVIOyyTYi1tO2eaBibdYrgh/5px7jDA5NZNJhVUsPVCM3N2e49GBmg5fUUZxqyhOrNVOckXpvbIkBsSm9OdGa+jLj0UZ7E2Eux2jnOcheOgyvahOrOkm8YBKjJiYXoSzLIx4v408rkqnvyCWlpS9HAv3pWSPhJoYKbXxMi5mRHL/RBJdSjkyyRaMd0WgtcOBCZEy9BqHEbQDnRnjtxTB25S5iRtwj19KbUIIV/PjOBntT0FCJBXZaeSlJpESLuNE9HbuFyewZ+825iTvx6QqD9lRP1yL4zBTlSIElO0gIE+U7TbFs2AFcd22BCZZURYhE7cYT2v2AQrj96FKjmHg2EG606OJkG7AKdGULSUWeGYtwTfLFJ+sZWxSLEaIaVrJd602HKizIvaCHUGnjfmmYj4OUj1Sd3px8Wg4xeKWWw7vQiUPxm/jClbHzMAlw4i1KUtxz7NhfZYl6xWrcMm0Qgg/b0t4ozUR7bb4KZcRmRxAfnkqSYVxuDpaoQzyoXDfdpRiY+SbnXHzcSH/VAbF5QpCDmzDLWUJ28qskJVZEFlrIXa7yZroNnsCKpZwSBHDwyevuf14iBs/viA1U0H8djcygiVkisTu9KW8voU7gy+5PficF8//Ii5tM8U9i1ENWFJ7wxwhrMGaqA4HfBQLaGppouv2A040X0DV2UOdup/cqnpSC0pILy2n7HwnZ7r7qe7opqShlcfDbyg/pSS72YDam6s41S8K83ssyOu3YXeJEfWN9XTfeYjqYi9n1H3UdX1P45UBmvpuidzkbM9VTeysKK3sUPPwl1ecrMoVhYYaYeVVUVgt3s7dXUVKlQGNzefovfeIGjG7EeEn6elLV6gbQXweidV391HZrubBz79RXpmjEao+Cv8BGzWyHVUDvLMAAAAASUVORK5CYII=" alt="Tejas Jadhav" style="position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;object-position:center;opacity:1;transition-delay:500ms;border-radius:50%"/><noscript><picture><source srcset="/static/bdbd30996dacf8129992301790511b07/8ba1e/profile-pic.png 1x,
/static/bdbd30996dacf8129992301790511b07/f937a/profile-pic.png 1.5x,
/static/bdbd30996dacf8129992301790511b07/71eb7/profile-pic.png 2x" /><img loading="lazy" width="50" height="50" srcset="/static/bdbd30996dacf8129992301790511b07/8ba1e/profile-pic.png 1x,
/static/bdbd30996dacf8129992301790511b07/f937a/profile-pic.png 1.5x,
/static/bdbd30996dacf8129992301790511b07/71eb7/profile-pic.png 2x" src="/static/bdbd30996dacf8129992301790511b07/8ba1e/profile-pic.png" alt="Tejas Jadhav" style="position:absolute;top:0;left:0;opacity:1;width:100%;height:100%;object-fit:cover;object-position:center"/></picture></noscript></div><p>Written by <strong>Tejas Jadhav</strong> <!-- -->full time software engineer</p></div></footer></article><nav><ul style="display:flex;flex-wrap:wrap;justify-content:space-between;list-style:none;padding:0"><li><a rel="prev" href="/importing-mi-notebook-air-a-nightmare/">← <!-- -->Importing Mi Notebook Air: A nightmare and an episode with the customs</a></li><li><a rel="next" href="/squashing-bugs-when-datetime-comparisons-go-wrong/">Squashing bugs: When datetime comparisons go wrong<!-- --> →</a></li></ul></nav></main><footer>© <!-- -->2021<!-- --> Tejas Jadhav</footer></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-89679997-1', 'auto', {});
      
      
      
      
      
      }</script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/introducing-django-task-scheduler/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-fc4d0f0a2c7f65435551.js"],"component---src-pages-404-js":["/component---src-pages-404-js-e8115d276c12f97c783c.js"],"component---src-pages-index-js":["/component---src-pages-index-js-af44e365573a27d3ab16.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-0de9500dca1e6e690244.js"]};/*]]>*/</script><script src="/component---src-templates-blog-post-js-0de9500dca1e6e690244.js" async=""></script><script src="/d5d7a013bc6c1e2b6d7db819052c16d7efea5559-baf100a1121eb9646ed4.js" async=""></script><script src="/app-fc4d0f0a2c7f65435551.js" async=""></script><script src="/styles-1c3c06048fccead674b8.js" async=""></script><script src="/framework-c88d07efb40e009babfb.js" async=""></script><script src="/webpack-runtime-90fe9894775700252564.js" async=""></script></body></html>